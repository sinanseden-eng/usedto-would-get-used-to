<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tlingit Storytelling & Grammar</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel to translate JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Styles -->
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .animate-fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
    </style>
</head>
<body class="bg-stone-50 text-stone-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONS ---
        // Defining icons manually so they work without imports
        const Icon = ({ d, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                <path d={d} />
            </svg>
        );

        const History = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>;
        const Mic = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg>;
        const Volume2 = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>;
        const Check = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>;
        const X = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>;
        const Info = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>;
        const RefreshCw = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>;
        const Brain = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>;
        const MessageSquare = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>;
        const AlertTriangle = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>;
        const Star = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>;
        const Edit3 = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></svg>;
        const RotateCcw = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>;
        const ArrowRight = (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" x2="19" y1="12" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>;

        // --- APP COMPONENT ---
        const StudyPage = () => {
            const [activeTab, setActiveTab] = useState('reading');
            const [speechSpeaking, setSpeechSpeaking] = useState(false);

            const storyTitle = "The Tlingit Storytellers";
            const storyText = `
                "When I was a child," says Clea Kalz, "my grandma used to tell me traditional stories, about Raven and how he brought light to our world."
                
                Clea is a member of the Tlingit tribe in North Alaska, and the oral stories her grandma told her preserve their culture and beliefs. Her grandmother remembered them because the Tlingit people had been telling the same stories for hundreds of years.
                
                Storytelling predates writing. In early societies, people would tell stories orally, passing on information from one generation to the next. There used to be stories to remember historical events, and there were stories that taught important life lessons, too.
                
                Today we are used to reading written accounts of past events. It would be hard to get used to memorizing stories again.
            `;

            const handleSpeak = () => {
                if ('speechSynthesis' in window) {
                    if (speechSpeaking) {
                        window.speechSynthesis.cancel();
                        setSpeechSpeaking(false);
                    } else {
                        const utterance = new SpeechSynthesisUtterance(storyText);
                        utterance.rate = 0.9; 
                        utterance.pitch = 1;
                        utterance.onend = () => setSpeechSpeaking(false);
                        window.speechSynthesis.speak(utterance);
                        setSpeechSpeaking(true);
                    }
                } else {
                    alert("Sorry, your browser doesn't support text-to-speech.");
                }
            };

            return (
                <div className="min-h-screen font-sans text-stone-800 pb-12">
                    {/* Navigation Header */}
                    <nav className="bg-teal-900 text-white p-4 shadow-lg sticky top-0 z-50">
                        <div className="max-w-5xl mx-auto flex flex-col sm:flex-row justify-between items-center">
                            <div className="flex items-center space-x-2 mb-4 sm:mb-0">
                                <Brain className="w-8 h-8 text-teal-300" />
                                <h1 className="text-xl font-bold tracking-wider">LINGUO<span className="text-teal-300">LAB</span> | Unit 8</h1>
                            </div>
                            <div className="flex space-x-2 bg-teal-800 rounded-lg p-1 overflow-x-auto max-w-full">
                                {['reading', 'grammar', 'practice', 'rewrite'].map((tab) => (
                                    <button
                                        key={tab}
                                        onClick={() => setActiveTab(tab)}
                                        className={`px-4 py-2 rounded-md text-sm font-medium transition-all duration-200 capitalize whitespace-nowrap ${
                                            activeTab === tab 
                                                ? 'bg-white text-teal-900 shadow-sm' 
                                                : 'text-teal-200 hover:bg-teal-700'
                                        }`}
                                    >
                                        {tab}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </nav>

                    {/* Main Content Area */}
                    <main className="max-w-5xl mx-auto mt-8 px-4">
                        
                        {/* READING SECTION */}
                        {activeTab === 'reading' && (
                            <div className="animate-fade-in">
                                <div className="grid md:grid-cols-2 gap-8 items-start">
                                    {/* Image */}
                                    <div className="relative group rounded-xl overflow-hidden shadow-2xl h-96 bg-stone-200">
                                        <img 
                                            src="image_7be5dc.jpg"
                                            onError={(e) => {
                                                e.target.onerror = null; 
                                                e.target.src = "https://images.unsplash.com/photo-1534528741775-53994a69daeb?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80";
                                                e.target.alt = "Fallback image (Local file not found)";
                                            }}
                                            alt="Clea Kalz" 
                                            className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105"
                                        />
                                        <div className="absolute inset-0 bg-gradient-to-t from-stone-900/80 via-transparent to-transparent"></div>
                                        <div className="absolute bottom-0 left-0 right-0 p-6 text-white">
                                            <h3 className="text-xl font-bold flex items-center">
                                                <History className="w-5 h-5 mr-2 text-teal-300" />
                                                The Storyteller
                                            </h3>
                                            <p className="text-teal-100 text-sm opacity-90 mt-1">Preserving history through the spoken word.</p>
                                        </div>
                                    </div>

                                    {/* Text Content */}
                                    <div className="bg-white p-8 rounded-xl shadow-sm border border-stone-200">
                                        <div className="flex justify-between items-start mb-6">
                                            <div>
                                                <span className="text-teal-600 font-bold text-xs tracking-widest uppercase mb-1 block">Reading Section</span>
                                                <h2 className="text-3xl font-serif font-bold text-stone-900">{storyTitle}</h2>
                                            </div>
                                            <button 
                                                onClick={handleSpeak}
                                                className={`p-3 rounded-full transition-colors ${speechSpeaking ? 'bg-red-100 text-red-600 animate-pulse' : 'bg-teal-50 text-teal-700 hover:bg-teal-100'}`}
                                                title="Listen to the story"
                                            >
                                                {speechSpeaking ? <Volume2 size={24} /> : <Mic size={24} />}
                                            </button>
                                        </div>

                                        <div className="leading-relaxed text-lg font-serif text-stone-700">
                                            <p>
                                                <span className="text-4xl float-left mr-2 mt-[-10px] font-bold text-teal-800">"</span>
                                                When I was a child," says Clea Kalz, "my grandma <span className="bg-yellow-100 px-1 rounded border-b-2 border-yellow-300 cursor-help" title="Repeated past action">used to tell</span> me traditional stories, about Raven and how he brought light to our world."
                                            </p>
                                            <p className="mt-4">
                                                Clea is a member of the Tlingit tribe in North Alaska, and the oral stories her grandma told her preserve their culture and beliefs. Her grandmother remembered them because the Tlingit people had been telling the same stories for hundreds of years.
                                            </p>
                                            <p className="mt-4">
                                                Storytelling predates writing. In early societies, people <span className="bg-yellow-100 px-1 rounded border-b-2 border-yellow-300 cursor-help" title="Repeated past action">would tell</span> stories orally, passing on information from one generation to the next. <span className="bg-orange-100 px-1 rounded border-b-2 border-orange-300 cursor-help" title="Past State">There used to be</span> stories to remember historical events, and there were stories that taught important life lessons, too.
                                            </p>
                                            <p className="mt-4">
                                                Today we <span className="bg-green-100 px-1 rounded border-b-2 border-green-300 cursor-help" title="Normal situation now">are used to reading</span> written accounts of past events. It would be hard to <span className="bg-blue-100 px-1 rounded border-b-2 border-blue-300 cursor-help" title="Process of becoming normal">get used to memorizing</span> stories again.
                                            </p>
                                        </div>
                                        
                                        <div className="mt-8 p-4 bg-teal-50 rounded-lg flex items-start space-x-3 text-sm text-teal-800">
                                            <Info className="w-5 h-5 flex-shrink-0 mt-0.5" />
                                            <p>Tip: Hover over the highlighted phrases to see a quick hint about the grammar usage!</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* GRAMMAR SECTION */}
                        {activeTab === 'grammar' && (
                            <div className="animate-fade-in space-y-8">
                                <div className="text-center max-w-2xl mx-auto">
                                    <h2 className="text-3xl font-bold text-stone-900 mb-3">Grammar Technology</h2>
                                    <p className="text-stone-600">Visualizing "Past Habits" vs. "Changing States"</p>
                                </div>

                                <div className="w-full max-w-3xl mx-auto aspect-video bg-stone-900 rounded-xl overflow-hidden shadow-xl border-4 border-white">
                                    <iframe 
                                        src="https://drive.google.com/file/d/1ZxVpta3vAD_PtbA6gFBi4Pqm9BcY5aFc/preview" 
                                        className="w-full h-full" 
                                        allow="autoplay; fullscreen"
                                        title="Grammar Video Lesson"
                                    ></iframe>
                                </div>

                                <div className="grid md:grid-cols-2 gap-6">
                                    {/* The Past */}
                                    <div className="bg-white rounded-2xl shadow-lg overflow-hidden border border-stone-200 flex flex-col h-full">
                                        <div className="bg-amber-500 p-4 text-white flex items-center space-x-3">
                                            <History size={24} />
                                            <h3 className="font-bold text-lg">The Past (No Longer True)</h3>
                                        </div>
                                        <div className="p-6 space-y-6 flex-grow">
                                            <div className="relative pl-6 border-l-4 border-amber-200">
                                                <h4 className="font-bold text-amber-700 flex items-center text-lg">used to + infinitive</h4>
                                                <p className="text-sm text-stone-600 mb-2">For <strong>actions</strong> OR <strong>states</strong> in the past that don't happen now.</p>
                                                <ul className="space-y-2 mt-3 text-sm text-stone-700">
                                                    <li className="italic">"My grandma <strong>used to tell</strong> me stories."</li>
                                                    <li className="italic">"I <strong>used to have</strong> short hair." (State)</li>
                                                </ul>
                                            </div>
                                            <div className="relative pl-6 border-l-4 border-amber-200">
                                                <h4 className="font-bold text-amber-700 flex items-center text-lg">would + infinitive</h4>
                                                <p className="text-sm text-stone-600 mb-2">Strictly for repeated <strong>actions</strong> only.</p>
                                                <ul className="space-y-2 mt-3 text-sm text-stone-700">
                                                    <li className="italic">"People <strong>would tell</strong> stories orally."</li>
                                                </ul>
                                            </div>
                                            <div className="bg-red-50 border border-red-200 rounded-lg p-4 mt-4">
                                                <div className="flex items-center text-red-700 font-bold mb-2 text-sm">
                                                    <AlertTriangle className="w-4 h-4 mr-2" /> CRITICAL RULE: State Verbs
                                                </div>
                                                <p className="text-xs text-red-800 mb-2">Verbs that describe a state (be, have, love, know) <strong>CANNOT</strong> use 'would'.</p>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Habits */}
                                    <div className="bg-white rounded-2xl shadow-lg overflow-hidden border border-stone-200 flex flex-col h-full">
                                        <div className="bg-teal-600 p-4 text-white flex items-center space-x-3">
                                            <RefreshCw size={24} />
                                            <h3 className="font-bold text-lg">Habits & Familiarity</h3>
                                        </div>
                                        <div className="p-6 space-y-6 flex-grow">
                                            <div className="relative pl-6 border-l-4 border-teal-200">
                                                <h4 className="font-bold text-teal-700 flex items-center text-lg">be used to + noun/-ing</h4>
                                                <p className="text-sm text-stone-600 mb-2">Something is normal/familiar for you <strong>now</strong>.</p>
                                                <ul className="space-y-2 mt-3 text-sm text-stone-700">
                                                    <li className="italic">"We <strong>are used to reading</strong>."</li>
                                                </ul>
                                                <div className="mt-2 flex items-center space-x-2 text-teal-700 text-xs font-medium"><Check size={14} /> State: Current Comfort</div>
                                            </div>
                                            <div className="relative pl-6 border-l-4 border-teal-200">
                                                <h4 className="font-bold text-teal-700 flex items-center text-lg">get used to + noun/-ing</h4>
                                                <p className="text-sm text-stone-600 mb-2">The <strong>process</strong> of something becoming normal.</p>
                                                <ul className="space-y-2 mt-3 text-sm text-stone-700">
                                                    <li className="italic">"It's hard to <strong>get used to memorizing</strong>."</li>
                                                </ul>
                                                <div className="mt-2 flex items-center space-x-2 text-teal-700 text-xs font-medium"><ArrowRight size={14} /> Action: The Change</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {/* PRACTICE SECTION */}
                        {activeTab === 'practice' && <PracticeSection />}

                        {/* REWRITE SECTION */}
                        {activeTab === 'rewrite' && <RewriteSection />}

                    </main>
                </div>
            );
        };

        // --- PRACTICE SUB-COMPONENT ---
        const PracticeSection = () => {
            const [feedback, setFeedback] = useState({}); 
            
            const exercises = [
                { id: 1, question: "Which sentence describes a repeated past action?", options: [{ id: 'a', text: "...my grandma used to tell me traditional stories..." }, { id: 'b', text: "There used to be stories to remember..." }, { id: 'c', text: "Today we are used to reading..." }], correctId: 'a', explanation: "'used to tell' implies she did it many times in the past." },
                { id: 2, question: "Which sentence describes a past state?", options: [{ id: 'a', text: "...my grandma used to tell me traditional stories..." }, { id: 'b', text: "There used to be stories to remember..." }], correctId: 'b', explanation: "'There used to be' describes existence (state)." },
                { id: 3, question: "In which sentence can 'used to' be replaced with 'would'?", options: [{ id: 'a', text: "...my grandma used to tell me traditional stories..." }, { id: 'b', text: "There used to be stories to remember..." }], correctId: 'a', explanation: "'would' is only for actions, like telling stories." },
                { id: 4, question: "Which describes something becoming normal?", options: [{ id: 'c', text: "Today we are used to reading..." }, { id: 'd', text: "It would be hard to get used to memorizing..." }], correctId: 'd', explanation: "'Get used to' describes the process." },
                { id: 5, question: "Which describes a normal habit now?", options: [{ id: 'c', text: "Today we are used to reading..." }, { id: 'd', text: "It would be hard to get used to memorizing..." }], correctId: 'c', explanation: "'Be used to' describes current familiarity." },
                { id: 6, question: "Which is correct?", options: [{ id: 'a', text: "I would live in London when I was young." }, { id: 'b', text: "I used to live in London when I was young." }], correctId: 'b', explanation: "'Live' is a state verb here. No 'would'." },
                { id: 7, question: "I am getting used to ___ in the city.", options: [{ id: 'a', text: "drive" }, { id: 'b', text: "driving" }], correctId: 'b', explanation: "After 'get used to', use the -ing form." },
                { id: 8, question: "Identify the mistake: 'She would have long hair.'", options: [{ id: 'a', text: "No mistake." }, { id: 'b', text: "Should be 'used to have'." }], correctId: 'b', explanation: "'Have' is a state verb." },
                { id: 9, question: "Did you ___ to play tennis?", options: [{ id: 'a', text: "use" }, { id: 'b', text: "used" }], correctId: 'a', explanation: "In questions with 'did', use the base form 'use'." },
                { id: 10, question: "Which is a process happening now?", options: [{ id: 'a', text: "I used to wake up early." }, { id: 'c', text: "I am getting used to waking up early." }], correctId: 'c', explanation: "Ongoing process = getting used to." },
                { id: 11, question: "My grandfather ___ tell us stories.", options: [{ id: 'a', text: "would" }, { id: 'b', text: "was used to" }], correctId: 'a', explanation: "Repeated past action." },
                { id: 12, question: "I can't ___ used to the cold!", options: [{ id: 'a', text: "be" }, { id: 'b', text: "get" }], correctId: 'b', explanation: "Adaptation/Transition = get." },
                { id: 13, question: "They ___ a beautiful house.", options: [{ id: 'a', text: "would have" }, { id: 'b', text: "used to have" }], correctId: 'b', explanation: "State verb 'have'." },
                { id: 14, question: "Is 'He is used to work hard' correct?", options: [{ id: 'a', text: "Yes" }, { id: 'b', text: "No" }], correctId: 'b', explanation: "Should be 'working'." },
                { id: 15, question: "Which is NOT strange anymore?", options: [{ id: 'a', text: "I used to do it." }, { id: 'b', text: "I am used to doing it." }], correctId: 'b', explanation: "Familiar now." }
            ];

            const handleAnswer = (qId, optionId, correctId) => {
                setFeedback(prev => ({ ...prev, [qId]: optionId === correctId ? 'correct' : 'incorrect' }));
            };

            return (
                <div className="max-w-2xl mx-auto animate-fade-in pb-12">
                    <div className="text-center mb-8">
                        <h2 className="text-3xl font-bold text-stone-900">Knowledge Check</h2>
                        <p className="text-stone-500">Connect the examples to the grammar rules.</p>
                    </div>
                    <div className="space-y-6">
                        {exercises.map((ex) => (
                            <div key={ex.id} className="bg-white p-6 rounded-xl shadow-md border border-stone-200">
                                <h3 className="font-bold text-lg text-stone-800 mb-4 flex items-start">
                                    <span className="bg-teal-100 text-teal-800 w-6 h-6 flex items-center justify-center rounded-full text-sm mr-3 mt-1 flex-shrink-0">{ex.id}</span>
                                    {ex.question}
                                </h3>
                                <div className="space-y-2 pl-9">
                                    {ex.options.map((opt) => (
                                        <button key={opt.id} onClick={() => handleAnswer(ex.id, opt.id, ex.correctId)} className={`w-full text-left p-3 rounded-lg border transition-all duration-200 flex justify-between items-center ${feedback[ex.id] === 'correct' && opt.id === ex.correctId ? 'bg-green-50 border-green-500 ring-1 ring-green-500' : ''} ${feedback[ex.id] === 'incorrect' && feedback[ex.id] !== 'correct' ? 'hover:bg-stone-50 border-stone-200' : 'hover:bg-teal-50 border-stone-200 hover:border-teal-300'}`} disabled={feedback[ex.id] === 'correct'}>
                                            <span className="text-stone-700">{opt.text}</span>
                                            {feedback[ex.id] === 'correct' && opt.id === ex.correctId && <Check size={20} className="text-green-600" />}
                                        </button>
                                    ))}
                                </div>
                                {feedback[ex.id] === 'correct' && <div className="mt-4 ml-9 p-3 bg-green-50 text-green-800 text-sm rounded-md flex items-start"><MessageSquare className="w-4 h-4 mt-0.5 mr-2 flex-shrink-0" />{ex.explanation}</div>}
                                {feedback[ex.id] === 'incorrect' && <div className="mt-4 ml-9 p-3 bg-red-50 text-red-800 text-sm rounded-md animate-shake">Not quite! Try again.</div>}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // --- REWRITE SUB-COMPONENT ---
        const RewriteSection = () => {
            const [answers, setAnswers] = useState({});
            const [results, setResults] = useState({});

            const rewrites = [
                { id: 1, original: "It was my habit to ride my bike to school.", keyword: "USED TO", correct: "I used to ride my bike to school", hint: "Start with 'I'...", explanation: "We use 'used to' for past habits." },
                { id: 2, original: "Every Sunday, my grandfather visited us.", keyword: "WOULD", correct: "My grandfather would visit us every Sunday", alternates: ["Every Sunday my grandfather would visit us"], hint: "Repeated past action.", explanation: "'Would' emphasizes repetition." },
                { id: 3, original: "It is normal for me to wake up early.", keyword: "AM USED TO", correct: "I am used to waking up early", hint: "Use -ing.", explanation: "After 'be used to', use verb + -ing." },
                { id: 4, original: "Driving on the left was strange, but now it's becoming normal.", keyword: "GETTING USED TO", correct: "I am getting used to driving on the left", hint: "Process of change.", explanation: "'Get used to' shows the process." },
                { id: 5, original: "It was her habit to smoke 20 cigarettes a day.", keyword: "USED TO", correct: "She used to smoke 20 cigarettes a day", hint: "Start with 'She'...", explanation: "Past habit = used to." },
                { id: 6, original: "It is becoming normal for him to wear glasses.", keyword: "GETTING USED TO", correct: "He is getting used to wearing glasses", hint: "Use -ing.", explanation: "Process = get used to." },
                { id: 7, original: "It is normal for them to eat dinner late.", keyword: "ARE USED TO", correct: "They are used to eating dinner late", hint: "Don't forget -ing.", explanation: "Current state = be used to." },
                { id: 8, original: "We went to the park every Saturday.", keyword: "WOULD", correct: "We would go to the park every Saturday", hint: "Repeated action.", explanation: "'Would' is good for repeated past actions." },
                { id: 9, original: "I didn't have a beard in the past.", keyword: "USE TO", correct: "I didn't use to have a beard", hint: "Negative form.", explanation: "didn't USE to (no 'd')." },
                { id: 10, original: "Is it normal for you to drive on the right?", keyword: "ARE YOU USED TO", correct: "Are you used to driving on the right", hint: "Question form.", explanation: "Asking about familiarity." },
                { id: 11, original: "The noise was strange at first, but it's okay now.", keyword: "GOT USED TO", correct: "I got used to the noise", hint: "Past tense of get.", explanation: "The process happened in the past." },
                { id: 12, original: "He was a teacher (but isn't now).", keyword: "USED TO", correct: "He used to be a teacher", hint: "State verb.", explanation: "Past states must use 'used to'." }
            ];

            const checkAnswer = (id) => {
                const userAns = answers[id]?.trim().toLowerCase().replace(/[.,!]/g, '') || "";
                const currentQ = rewrites.find(q => q.id === id);
                const correctAns = currentQ.correct.toLowerCase().replace(/[.,!]/g, '');
                const alternateAns = currentQ.alternates?.map(a => a.toLowerCase().replace(/[.,!]/g, ''));

                if (userAns === correctAns || (alternateAns && alternateAns.includes(userAns))) {
                    setResults(prev => ({ ...prev, [id]: 'correct' }));
                } else {
                    setResults(prev => ({ ...prev, [id]: 'incorrect' }));
                }
            };

            const reset = (id) => {
                setAnswers(prev => ({ ...prev, [id]: '' }));
                setResults(prev => { const newRes = { ...prev }; delete newRes[id]; return newRes; });
            };

            return (
                <div className="max-w-3xl mx-auto animate-fade-in pb-12">
                    <div className="text-center mb-8">
                        <h2 className="text-3xl font-bold text-stone-900">Rewrite Challenge</h2>
                        <p className="text-stone-500">Type the sentence again using the grammar keyword.</p>
                    </div>
                    <div className="space-y-8">
                        {rewrites.map((item) => (
                            <div key={item.id} className="bg-white rounded-xl shadow-md border border-stone-200 overflow-hidden">
                                <div className="bg-stone-100 p-4 border-b border-stone-200 flex justify-between items-center">
                                    <span className="font-bold text-stone-600">Question {item.id}</span>
                                    <div className="flex items-center text-xs font-bold text-teal-700 bg-teal-100 px-2 py-1 rounded uppercase tracking-wide"><Edit3 size={12} className="mr-1" /> Use: {item.keyword}</div>
                                </div>
                                <div className="p-6">
                                    <p className="text-lg text-stone-800 mb-4 font-serif italic">"{item.original}"</p>
                                    <div className="relative">
                                        <input type="text" value={answers[item.id] || ''} onChange={(e) => setAnswers({...answers, [item.id]: e.target.value})} placeholder="Type your answer here..." className={`w-full p-4 rounded-lg border-2 outline-none transition-all font-medium ${results[item.id] === 'correct' ? 'border-green-500 bg-green-50 text-green-800' : results[item.id] === 'incorrect' ? 'border-red-300 bg-red-50' : 'border-stone-200 focus:border-teal-500'}`} disabled={results[item.id] === 'correct'} />
                                        {results[item.id] === 'correct' && <div className="absolute right-4 top-4 text-green-600 animate-bounce"><Check size={24} /></div>}
                                    </div>
                                    {results[item.id] === 'incorrect' && <div className="mt-4 animate-fade-in"><div className="p-3 bg-red-50 text-red-800 rounded-lg text-sm mb-2 flex items-start"><AlertTriangle size={16} className="mr-2 mt-0.5 flex-shrink-0" /><div><strong>Not quite.</strong><p className="mt-1">Correct answer: <span className="font-mono bg-white px-1 rounded border border-red-200">{item.correct}</span></p></div></div><div className="flex items-center text-stone-500 text-xs"><Info size={12} className="mr-1" /> {item.explanation}</div></div>}
                                    {results[item.id] === 'correct' && <div className="mt-4 animate-fade-in p-3 bg-green-50 text-green-800 rounded-lg text-sm flex items-start"><Star size={16} className="mr-2 mt-0.5 flex-shrink-0 text-yellow-500" /><div><strong>Excellent!</strong> {item.explanation}</div></div>}
                                    <div className="mt-6 flex justify-end space-x-3">
                                        {results[item.id] ? (
                                            <button onClick={() => reset(item.id)} className="flex items-center px-4 py-2 text-stone-500 hover:text-stone-800 hover:bg-stone-100 rounded transition-colors"><RotateCcw size={16} className="mr-2" /> Try Again</button>
                                        ) : (
                                            <button onClick={() => checkAnswer(item.id)} className="px-6 py-2 bg-teal-600 hover:bg-teal-700 text-white font-bold rounded-lg shadow transition-transform active:scale-95">Check Answer</button>
                                        )}
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<StudyPage />);
    </script>
</body>
</html>
